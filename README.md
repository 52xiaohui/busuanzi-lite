# Busuanzi-Lite

ä¸€ä¸ªè½»é‡çº§çš„ç½‘ç«™è®¿é—®ç»Ÿè®¡ç³»ç»Ÿï¼ŒåŸºäº Node.js å’Œ Redisã€‚

## åŠŸèƒ½ç‰¹ç‚¹

- ğŸš€ è½»é‡çº§ï¼Œæ˜“äºéƒ¨ç½²
- ğŸ“Š ç»Ÿè®¡ PVï¼ˆé¡µé¢è®¿é—®é‡ï¼‰å’Œ UVï¼ˆç‹¬ç«‹è®¿å®¢æ•°ï¼‰
- ğŸ“ˆ æ”¯æŒç«™ç‚¹æ€»é‡å’Œå•é¡µé¢ç»Ÿè®¡
- ğŸ”„ å®æ—¶æ›´æ–°
- ğŸ“± å“åº”å¼è®¾è®¡
- ğŸ›¡ï¸ å†…ç½®é™æµä¿æŠ¤
- ğŸ¯ ç²¾ç¡®çš„UVç»Ÿè®¡ï¼ˆåŸºäºHyperLogLogï¼‰
- ğŸ“Š å¯è§†åŒ–ç®¡ç†ç•Œé¢
- ğŸ“¥ æ•°æ®å¯¼å‡ºåŠŸèƒ½

## ç³»ç»Ÿè¦æ±‚

- Node.js >= 14
- Redis >= 6
- npm æˆ– yarn

## å¿«é€Ÿå¼€å§‹

1. å…‹éš†ä»“åº“ï¼š
```
git clone https://github.com/ä½ çš„ç”¨æˆ·å/busuanzi-lite.git
cd busuanzi-lite
```
2. å®‰è£…ä¾èµ–ï¼š
```
npm install
```
3. é…ç½®ç¯å¢ƒå˜é‡ï¼š
```
cp .env.example .env
#ç¼–è¾‘ .env æ–‡ä»¶ï¼Œè®¾ç½®ä½ çš„é…ç½®ï¼š
PORT=3000
REDIS_URL=redis://127.0.0.1:6379
NODE_ENV=development
```

4. å¯åŠ¨æœåŠ¡ï¼š
```
npm start
```

## ä½¿ç”¨æ–¹æ³•

1. åœ¨ä½ çš„ç½‘é¡µä¸­å¼•å…¥ç»Ÿè®¡è„šæœ¬ï¼š
```
<script async src="http://ä½ çš„åŸŸå/js/count.js"></script>
```

2. æ·»åŠ ç»Ÿè®¡æ˜¾ç¤ºå…ƒç´ ï¼š
```
<span id="busuanzi_container_site_pv">
    æ€»è®¿é—®é‡: <span id="busuanzi_value_site_pv"></span>
</span>
<span id="busuanzi_container_site_uv">
    æ€»è®¿å®¢æ•°: <span id="busuanzi_value_site_uv"></span>
</span>
<span id="busuanzi_container_page_pv">
    æœ¬é¡µè®¿é—®é‡: <span id="busuanzi_value_page_pv"></span>
</span>
```

## ç®¡ç†ç•Œé¢

è®¿é—® http://ä½ çš„åŸŸå:3000/admin.html è¿›å…¥ç®¡ç†ç•Œé¢ï¼Œå¯ä»¥ï¼š

- æŸ¥çœ‹å®æ—¶è®¿é—®ç»Ÿè®¡
- æŸ¥çœ‹è®¿é—®è¶‹åŠ¿å›¾è¡¨
- æŸ¥çœ‹æœ€è¿‘è®¿é—®è®°å½•
- å¯¼å‡ºç»Ÿè®¡æ•°æ®
- é‡ç½®ç»Ÿè®¡æ•°æ®ï¼ˆä»…å¼€å‘ç¯å¢ƒï¼‰

## API è¯´æ˜

### è·å–è®¿é—®ç»Ÿè®¡
- ç«¯ç‚¹ï¼šGET /count
- å‚æ•°ï¼š
  - url: é¡µé¢URLï¼ˆå¿…éœ€ï¼‰
- è¿”å›ç¤ºä¾‹ï¼š
```
{
  "totalPV": "100",
  "pagePV": "10",
  "totalUV": "50",
  "pageUV": "5"
}
```

### ç®¡ç†æ¥å£
- è·å–ç»Ÿè®¡æ•°æ®ï¼šGET /admin/stats
- å¯¼å‡ºæ•°æ®ï¼šGET /admin/export
- é‡ç½®æ•°æ®ï¼šPOST /admin/resetï¼ˆä»…å¼€å‘ç¯å¢ƒï¼‰

## å¼€å‘

1. æµ‹è¯• Redis è¿æ¥ï¼š
```
node redis_test.js
```

2. è¿è¡Œå¼€å‘æœåŠ¡å™¨ï¼š
```
npm run dev
```

## éƒ¨ç½²

1. ä¿®æ”¹ .env æ–‡ä»¶ï¼š
```
PORT=3000
REDIS_URL=redis://ä½ çš„Redisåœ°å€:6379
NODE_ENV=production
```

2. ä½¿ç”¨ PM2 è¿è¡Œï¼š
```
npm install -g pm2
pm2 start server.js --name busuanzi-lite
```
3. é…ç½®åå‘ä»£ç†



## æ•°æ®å¤‡ä»½
ç”±äº Redis æ˜¯åŸºäºå†…å­˜çš„ï¼Œæ•°æ®å¯èƒ½ä¼šä¸¢å¤±ï¼Œå»ºè®®å®šæœŸå¤‡ä»½ Redis æ•°æ®ï¼š

1. è‡ªåŠ¨å¤‡ä»½ï¼ˆä½¿ç”¨ crontabï¼‰ï¼š
```
0 2 * * * redis-cli SAVE
```

2. æ‰‹åŠ¨å¤‡ä»½ï¼š
```
redis-cli SAVE
```

å¤‡ä»½æ–‡ä»¶é»˜è®¤ä¿å­˜åœ¨ /var/lib/redis/dump.rdb

## å¸¸è§é—®é¢˜

1. Redis è¿æ¥å¤±è´¥
- æ£€æŸ¥ Redis æœåŠ¡æ˜¯å¦è¿è¡Œ
- æ£€æŸ¥è¿æ¥åœ°å€å’Œç«¯å£
- æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

2. ç»Ÿè®¡æ•°æ®ä¸æ›´æ–°
- æ£€æŸ¥ JavaScript æ§åˆ¶å°é”™è¯¯
- ç¡®è®¤ count.js è·¯å¾„æ­£ç¡®
- æ£€æŸ¥ CORS è®¾ç½®

3. ç®¡ç†ç•Œé¢æ— æ³•è®¿é—®
- ç¡®è®¤æœåŠ¡å™¨æ­£å¸¸è¿è¡Œ
- æ£€æŸ¥ç«¯å£é…ç½®
- æŸ¥çœ‹æœåŠ¡å™¨é”™è¯¯æ—¥å¿—

## è®¸å¯è¯

MIT

## è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## æ›´æ–°æ—¥å¿—

### v1.0.0
- åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- åŸºæœ¬çš„ PV/UV ç»Ÿè®¡åŠŸèƒ½
- ç®¡ç†ç•Œé¢
- æ•°æ®å¯¼å‡ºåŠŸèƒ½

## ä½œè€…

[xiaohui](52xiaohuia@gmail.com)

## é¸£è°¢

- [Express](https://expressjs.com/)
- [Redis](https://redis.io/)
- [Chart.js](https://www.chartjs.org/)
- [ä¸è’œå­](http://busuanzi.ibruce.info/)ï¼ˆçµæ„Ÿæ¥æºï¼‰